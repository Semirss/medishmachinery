<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | MachineryHub</title>
  <!-- Using local Tailwind CSS to avoid CDN warnings -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    // Tailwind config matching index page
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'heading': ['Exo 2', 'sans-serif'],
            'body': ['Inter', 'sans-serif'],
          },
          colors: {
            'industrial': {
              'yellow': '#FFB347',
              'orange': '#FF8C00',
              'gray': '#2D3748',
              'blue': '#4299E1',
              'safety': '#FF6B35',
              'green': '#10B981',
              'dark': '#1A202C',
              'light-gray': '#F7FAFC'
            }
          },
          boxShadow: {
            'card': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
            'card-hover': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
            'heavy': '0 10px 25px -5px rgba(0, 0, 0, 0.15)',
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'pulse-border': 'pulse-border 2s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            'pulse-border': {
              '0%': { boxShadow: '0 0 0 0 rgba(255, 179, 71, 0.7)' },
              '70%': { boxShadow: '0 0 0 10px rgba(255, 179, 71, 0)' },
              '100%': { boxShadow: '0 0 0 0 rgba(255, 179, 71, 0)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    /* Custom scrollbar matching index page */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #FFB347;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #FF8C00;
    }

    /* Status badge styling */
    .status-badge {
      @apply px-3 py-1 text-xs font-semibold rounded-full border transition-all duration-200;
    }

    /* Loading animation */
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #FFB347;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Safety stripes */
    .safety-stripes {
      background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255, 107, 53, 0.05) 10px, rgba(255, 107, 53, 0.05) 20px);
    }

    .gear-icon {
      display: inline-block;
      width: 24px;
      height: 24px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'%3E%3C/path%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
    }

    /* Modal overlay */
    .modal-overlay {
      cursor: pointer;
    }

    .modal-content {
      cursor: auto;
    }
  </style>
</head>

<body class="bg-gray-50 font-body text-gray-800 antialiased h-screen flex overflow-hidden selection:bg-industrial-yellow selection:text-white">

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 z-[60] flex items-center justify-center bg-gray-200/95 backdrop-blur-md transition-all duration-300">
        <div class="bg-white p-8 md:p-10 rounded-3xl shadow-2xl w-full max-w-md relative overflow-hidden group border border-gray-100">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-industrial-yellow to-orange-500"></div>
            
            <div class="text-center mb-10">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-3xl bg-industrial-yellow/10 text-industrial-yellow mb-6 shadow-sm group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-cubes text-4xl"></i>
                </div>
                <h1 class="text-3xl font-heading font-black text-gray-900 tracking-tight">Login<span class="text-industrial-yellow">Portal</span></h1>
                <p class="text-gray-500 mt-2 font-medium">Manage your fleet & orders</p>
            </div>

            <form id="loginForm" onsubmit="login(event)" class="space-y-5">
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Username</label>
                    <input type="text" id="username" required 
                        class="w-full px-5 py-3.5 rounded-2xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-industrial-yellow focus:ring-4 focus:ring-industrial-yellow/10 outline-none transition-all font-medium" 
                        placeholder="Enter your username">
                </div>
                <div class="space-y-1.5">
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Password</label>
                    <input type="password" id="password" required 
                        class="w-full px-5 py-3.5 rounded-2xl border border-gray-200 bg-gray-50 focus:bg-white focus:border-industrial-yellow focus:ring-4 focus:ring-industrial-yellow/10 outline-none transition-all font-medium" 
                        placeholder="••••••••">
                </div>
                
                <div id="loginError" class="hidden p-4 rounded-xl bg-red-50 border border-red-100 text-red-600 text-sm flex items-center animate-pulse">
                    <i class="fas fa-exclamation-circle mr-3 text-lg"></i> <span class="font-bold">Invalid credentials. Try again.</span>
                </div>

                <button type="submit" 
                    class="w-full py-4 rounded-2xl bg-industrial-yellow text-industrial-dark font-black text-lg shadow-lg hover:shadow-xl hover:bg-industrial-orange hover:-translate-y-1 transition-all duration-300 flex items-center justify-center">
                    <span>Log In Dashboard</span> <i class="fas fa-arrow-right ml-2 opacity-70"></i>
                </button>
            </form>
            
             <div class="mt-8 text-center border-t border-gray-100 pt-6">
                <p class="text-gray-400 text-sm mb-2">New to the platform?</p>
                <a href="signup.html" class="inline-flex items-center text-industrial-dark hover:text-industrial-orange font-bold transition-colors">
                    Create Partner Account <i class="fas fa-user-plus ml-2"></i>
                </a>
             </div>
        </div>
    </div>

    <!-- Admin Content Wrapper -->
    <div id="adminContent" class="hidden flex w-full h-full">
        
        <!-- Desktop Sidebar -->
        <aside class="hidden lg:flex w-72 bg-slate-900 text-white flex-col flex-shrink-0 z-20 shadow-2xl relative">
            <div class="h-20 flex items-center px-8 border-b border-slate-800 bg-slate-900">
                <i class="fas fa-cube text-industrial-yellow text-2xl mr-3"></i>
                <span class="text-xl font-heading font-bold tracking-tight">Machining<span class="text-industrial-yellow">Hub</span></span>
            </div>

            <!-- Profile Widget -->
            <div class="p-6 border-b border-slate-800 bg-slate-800/50">
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-industrial-yellow to-orange-500 flex items-center justify-center text-white font-bold text-lg shadow-lg">
                            <span class="partner-initials">P</span>
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-slate-800 rounded-full"></div>
                    </div>
                    <div class="overflow-hidden">
                        <p class="font-bold text-sm truncate partner-name text-white">Partner</p>
                        <p class="text-xs text-slate-400 truncate partner-company">Company</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1.5">
                <p class="px-4 text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">Menu</p>
                <button onclick="showTab('dashboard')" id="tab-dashboard" class="w-full text-left px-5 py-3.5 rounded-xl flex items-center transition-all group bg-industrial-yellow text-industrial-gray shadow-lg ring-1 ring-white/10">
                    <i class="fas fa-chart-pie w-6 mr-3 text-lg group-hover:scale-110 transition-transform"></i>
                    <span class="font-bold">Dashboard</span>
                </button>
                <button onclick="showTab('inventory')" id="tab-inventory" class="w-full text-left px-5 py-3.5 rounded-xl flex items-center transition-all group text-slate-400 hover:bg-slate-800 hover:text-white">
                    <i class="fas fa-tractor w-6 mr-3 text-lg group-hover:scale-110 transition-transform"></i>
                    <span class="font-semibold">Inventory</span>
                </button>
                <button onclick="showTab('orders')" id="tab-orders" class="w-full text-left px-5 py-3.5 rounded-xl flex items-center transition-all group text-slate-400 hover:bg-slate-800 hover:text-white">
                    <i class="fas fa-clipboard-check w-6 mr-3 text-lg group-hover:scale-110 transition-transform"></i>
                    <span class="font-semibold">Orders</span>
                </button>
            </nav>

            <div class="p-4 border-t border-slate-800">
                <button onclick="logout()" class="w-full py-3.5 rounded-xl bg-slate-800 hover:bg-red-500/10 hover:text-red-400 text-slate-400 transition-all font-bold flex items-center justify-center group border border-slate-700 hover:border-red-500/20">
                    <i class="fas fa-power-off mr-2 group-hover:rotate-90 transition-transform"></i> Sign Out
                </button>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div id="mobileSidebar" class="lg:hidden fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="toggleMobileMenu()"></div>
            <div class="absolute left-0 top-0 h-full w-72 bg-slate-900 text-white shadow-2xl animate-slide-right flex flex-col border-r border-slate-800">
                 <div class="h-20 flex items-center px-6 border-b border-slate-800">
                   <span class="text-xl font-heading font-black tracking-tight">Menu</span>
                   <button onclick="toggleMobileMenu()" class="ml-auto w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
                 </div>
                  <nav class="flex-1 py-6 px-4 space-y-2">
                     <button onclick="showTab('dashboard'); toggleMobileMenu()" class="w-full text-left px-5 py-3 rounded-xl flex items-center text-slate-200 hover:bg-slate-800 font-bold"><i class="fas fa-chart-pie mr-3 w-5"></i> Dashboard</button>
                     <button onclick="showTab('inventory'); toggleMobileMenu()" class="w-full text-left px-5 py-3 rounded-xl flex items-center text-slate-200 hover:bg-slate-800 font-bold"><i class="fas fa-tractor mr-3 w-5"></i> Inventory</button>
                     <button onclick="showTab('orders'); toggleMobileMenu()" class="w-full text-left px-5 py-3 rounded-xl flex items-center text-slate-200 hover:bg-slate-800 font-bold"><i class="fas fa-clipboard-check mr-3 w-5"></i> Orders</button>
                  </nav>
                  <div class="p-4 mt-auto border-t border-slate-800">
                     <button onclick="logout()" class="w-full py-3 text-red-400 font-bold"><i class="fas fa-sign-out-alt mr-2"></i> Log Out</button>
                  </div>
            </div>
        </div>

        <!-- Main Content (Right Side) -->
        <div class="flex-1 flex flex-col h-full overflow-hidden bg-gray-50 relative">
            
            <!-- Mobile Header -->
            <header class="lg:hidden h-16 bg-white border-b border-gray-100 flex items-center justify-between px-4 z-10 shadow-sm flex-shrink-0">
               <div class="flex items-center">
                  <button id="mobileMenuBtn" class="p-2 -ml-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors"><i class="fas fa-bars text-xl"></i></button>
                  <span class="font-heading font-bold text-lg text-gray-800 ml-2">Login<span class="text-industrial-yellow">Portal</span></span>
               </div>
               <div class="flex items-center space-x-3">
                   <div class="w-9 h-9 rounded-full bg-industrial-yellow text-white flex items-center justify-center font-bold text-sm shadow-md">
                       <i class="fas fa-user"></i>
                   </div>
               </div>
            </header>

            <!-- Desktop Header -->
            <header class="hidden lg:flex h-20 bg-white/80 backdrop-blur-md border-b border-gray-100 items-center justify-between px-8 z-10 sticky top-0 flex-shrink-0">
               <div class="flex items-center space-x-4">
                   <h2 class="text-2xl font-bold font-heading text-gray-800 tracking-tight">Overview</h2>
               </div>
               
               <div class="flex items-center space-x-6">
                  <div class="relative">
                      <span class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                      <button class="text-gray-400 hover:text-industrial-yellow transition-colors"><i class="fas fa-bell text-xl"></i></button>
                  </div>
                  <div class="h-8 w-px bg-gray-200/50"></div>
                  <a href="index.html" target="_blank" class="flex items-center px-4 py-2 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 font-bold text-sm transition-all border border-gray-100">
                     <i class="fas fa-external-link-alt mr-2"></i> View Site
                  </a>
               </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
          
         
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content space-y-8 animate-fade-in text-left">
            <!-- Header -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-b border-gray-200 pb-6">
                <div>
                   <h2 class="text-3xl font-heading font-black text-gray-900 tracking-tight">Dashboard Overview</h2>
                   <p class="text-gray-500 font-medium mt-1">Real-time fleet status & performance metrics</p>
                </div>
                <button onclick="refreshAllData()" class="px-5 py-2.5 bg-white border-2 border-gray-100 text-gray-700 font-bold rounded-xl shadow-sm hover:border-industrial-yellow hover:text-industrial-yellow transition-all flex items-center group">
                   <i class="fas fa-sync-alt mr-2 group-hover:rotate-180 transition-transform"></i> Refresh Data
                </button>
            </div>
    
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Total Machines -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-industrial-yellow/5 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Total Fleet</p>
                            <h3 id="dashboard-total-machines" class="text-3xl font-heading font-black text-gray-900 mt-2">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-2xl bg-industrial-yellow/10 flex items-center justify-center text-industrial-yellow text-xl shadow-sm">
                            <i class="fas fa-truck-monster"></i>
                        </div>
                    </div>
                    <div class="mt-6 flex items-center text-xs font-bold relative z-10">
                        <span class="text-green-600 bg-green-50 px-2.5 py-1 rounded-lg border border-green-100"><i class="fas fa-check-circle mr-1"></i> <span id="available-machines">0</span> Avail</span>
                        <span class="mx-2 text-gray-300">|</span>
                        <span class="text-orange-600 bg-orange-50 px-2.5 py-1 rounded-lg border border-orange-100"><i class="fas fa-clock mr-1"></i> <span id="rented-machines">0</span> Rented</span>
                    </div>
                </div>
    
                <!-- Pending Orders -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-blue-500/5 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Pending Orders</p>
                            <h3 id="dashboard-pending-orders" class="text-3xl font-heading font-black text-gray-900 mt-2">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center text-blue-500 text-xl shadow-sm">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                    </div>
                    <div class="mt-6 text-sm font-bold text-blue-500 relative z-10 flex items-center">
                        <i class="fas fa-arrow-right mr-2 text-xs"></i> Needs Processing
                    </div>
                </div>
    
                <!-- Unverified -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-red-500/5 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <div class="flex justify-between items-start relative z-10">
                         <div>
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Action Required</p>
                            <h3 id="dashboard-unverified-payments" class="text-3xl font-heading font-black text-gray-900 mt-2">0</h3>
                        </div>
                        <div class="w-12 h-12 rounded-2xl bg-red-500/10 flex items-center justify-center text-red-500 text-xl shadow-sm">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                    <div class="mt-6 text-sm font-bold text-red-500 relative z-10 flex items-center">
                        <i class="fas fa-arrow-right mr-2 text-xs"></i> Check Payments
                    </div>
                </div>
                
                 <!-- Revenue (Placeholder) -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-purple-500/5 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Monthly Revenue</p>
                            <h3 class="text-3xl font-heading font-black text-gray-900 mt-2">$--</h3>
                        </div>
                        <div class="w-12 h-12 rounded-2xl bg-purple-500/10 flex items-center justify-center text-purple-500 text-xl shadow-sm">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="mt-6 text-sm font-bold text-purple-500 relative z-10 flex items-center">
                        <i class="fas fa-arrow-up mr-2 text-xs"></i> +12% vs Last Month
                    </div>
                </div>
            </div>
    
            <!-- Recent Activity -->
            <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500">
                             <i class="fas fa-history"></i>
                        </div>
                        <h3 class="font-heading text-xl font-bold text-gray-900">Recent Activity</h3>
                    </div>
                </div>
                <div id="recentActivity" class="space-y-4">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

      <!-- Inventory Tab -->
      <div id="inventory" class="tab-content hidden">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
          <div>
            <h2 class="text-2xl md:text-3xl font-heading font-bold">Machine Inventory</h2>
            <p class="text-gray-600">Manage all machinery in the rental fleet</p>
          </div>
          <div class="flex flex-wrap items-center gap-3 mt-4 md:mt-0">
            <div class="relative">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              <input type="text" id="inventorySearch" placeholder="Search machines..."
                class="pl-10 pr-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 outline-none w-full md:w-64"
                onkeyup="filterInventoryGrid()">
            </div>
            <select id="inventoryFilter" onchange="filterInventoryGrid()"
              class="border-2 border-gray-200 rounded-xl p-2.5 focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 outline-none bg-white">
              <option value="all">All Categories</option>
              <option value="EXCAVATOR">Excavator</option>
              <option value="DOZER">Dozer</option>
              <option value="GRADER">Grader</option>
              <option value="LOADER">Loader</option>
              <option value="ROLLER">Roller</option>
              <option value="CRANE">Crane</option>
              <option value="WATER_TRUCK">Water Truck</option>
              <option value="DUMP_TRUCK">Dump Truck</option>
            </select>
            <button onclick="openMachineForm()"
              class="bg-industrial-yellow text-industrial-gray font-semibold py-2.5 px-4 rounded-xl shadow-md hover:bg-industrial-orange transition-all flex items-center whitespace-nowrap">
              <i class="fas fa-plus mr-2"></i>
              Add New Machine
            </button>
          </div>
        </div>

        <!-- Inventory Grid -->
        <div id="inventoryGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
          <!-- Will be populated by JavaScript -->
          <div id="inventoryLoading" class="col-span-full text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-500">Loading inventory data...</p>
          </div>
        </div>

        <!-- Empty State -->
        <div id="inventoryEmpty" class="hidden text-center py-12">
          <i class="fas fa-hard-hat text-gray-300 text-4xl mb-4"></i>
          <h3 class="text-xl font-heading font-bold text-gray-500">No machines found</h3>
          <p class="text-gray-400 mt-2">Add your first machine to get started</p>
          <button onclick="openMachineForm()"
            class="mt-4 bg-industrial-yellow text-industrial-gray font-semibold py-2.5 px-4 rounded-xl hover:bg-industrial-orange transition-colors">
            Add New Machine
          </button>
        </div>
      </div>

      <!-- Orders Tab -->
      <div id="orders" class="tab-content hidden ">
        <div class="flex flex-col max-w-6xl md:flex-row justify-between items-start md:items-center mb-8">
          <div>
            <h2 class="text-2xl md:text-3xl font-heading font-bold">Order Management</h2>
            <p class="text-gray-600">Manage customer orders and payments</p>
          </div>
          <div class="flex flex-wrap items-center gap-3 mt-4 md:mt-0">
            <div class="relative">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              <input type="text" id="orderSearch" placeholder="Search orders..."
                class="pl-10 pr-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 outline-none w-full md:w-64"
                onkeyup="filterOrderTable()">
            </div>
            <select id="orderStatusFilter" onchange="filterOrderTable()"
              class="border-2 border-gray-200 rounded-xl p-2.5 focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 outline-none bg-white">
              <option value="all">All Status</option>
              <option value="pending">Pending</option>
              <option value="pending_payment">Awaiting Payment</option>
              <option value="confirmed">Confirmed</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
        </div>

        <!-- Orders Table -->
        <div class="bg-white rounded-2xl shadow-card overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-industrial-gray text-white">
                <tr class="text-left text-sm font-heading font-semibold uppercase tracking-wider">
                  <th class="p-4">Order ID</th>
                  <th class="p-4">Date</th>
                  <th class="p-4">Total</th>
                  <th class="p-4">Payment</th>
                  <th class="p-4">Status</th>
                  <th class="p-4">Customer</th>
                  <th class="p-4 text-center">Actions</th>
                </tr>
              </thead>
              <tbody id="orderList" class="bg-white divide-y divide-gray-200">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div id="ordersEmpty" class="hidden p-8 text-center">
            <i class="fas fa-clipboard-list text-gray-300 text-4xl mb-4"></i>
            <h3 class="text-xl font-heading font-bold text-gray-500">No orders found</h3>
            <p class="text-gray-400 mt-2">Orders will appear here when customers make rentals</p>
          </div>

          <!-- Loading State -->
          <div id="ordersLoading" class="p-8 text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-500">Loading orders data...</p>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

    <!-- Machine Form Modal -->
    <div id="machineFormModal"
      class="hidden fixed inset-0 bg-black/70 flex justify-center items-center p-4 z-50 modal-overlay"
      onclick="closeModalOnOutsideClick(event, 'machineFormModal')">
      <div
        class="bg-white max-w-2xl w-full p-6 md:p-8 rounded-2xl relative max-h-[90vh] overflow-y-auto shadow-heavy animate-slide-up modal-content"
        onclick="event.stopPropagation()">
        <button onclick="closeMachineForm()"
          class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl transition-colors">
          <i class="fas fa-times"></i>
        </button>
        <h3 id="machineFormTitle" class="text-2xl font-heading font-bold mb-2">Add New Machine</h3>
        <p class="text-gray-600 mb-6">Fill in the details for the new machinery</p>

        <form id="machineForm" onsubmit="saveMachine(event)" class="space-y-6">
          <input type="hidden" id="machineId">

          <!-- Validation Error Container -->
          <div id="formErrors" class="hidden bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-xl">
            <p class="font-medium flex items-center"><i class="fas fa-exclamation-circle mr-2"></i>Please fix the
              following errors:</p>
            <ul id="errorList" class="mt-2 ml-6 list-disc text-sm"></ul>
          </div>

          <!-- Form Fields Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-tag text-industrial-blue mr-2"></i>
                Machine Name *
              </label>
              <input type="text" id="m-name" required
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                placeholder="e.g., CAT 320D Excavator">
              <p class="text-xs text-gray-500 mt-1">Enter the full machine model name</p>
            </div>

            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-folder text-industrial-blue mr-2"></i>
                Category *
              </label>
              <select id="m-category" required
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200 bg-white">
                <option value="">Select Category</option>
                <option value="EXCAVATOR">Excavator</option>
                <option value="DOZER">Dozer</option>
                <option value="GRADER">Grader</option>
                <option value="LOADER">Loader</option>
                <option value="ROLLER">Roller</option>
                <option value="CRANE">Crane</option>
                <option value="WATER_TRUCK">Water Truck</option>
                <option value="DUMP_TRUCK">Dump Truck</option>
              </select>
            </div>

            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-dollar-sign text-industrial-blue mr-2"></i>
                Price/Day ($) *
              </label>
              <input type="number" id="m-price" required min="1" step="0.01"
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                placeholder="e.g., 350.00">
              <p class="text-xs text-gray-500 mt-1">Minimum $1 per day</p>
            </div>

            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-info-circle text-industrial-blue mr-2"></i>
                Listing Type *
              </label>
              <select id="m-listingType" required
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200 bg-white">
                <option value="Rent">For Rent</option>
                <option value="Sale">For Sale</option>
              </select>
            </div>

            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-circle text-industrial-blue mr-2"></i>
                Status *
              </label>
              <select id="m-status" required
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200 bg-white">
                <option value="Available">Available</option>
                <option value="Rented">Rented</option>
                <option value="Maintenance">Maintenance</option>
              </select>
            </div>

            <div>
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-star text-industrial-blue mr-2"></i>
                Condition
              </label>
              <select id="m-condition"
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200 bg-white">
                <option value="Excellent">Excellent</option>
                <option value="Good">Good</option>
                <option value="Fair">Fair</option>
                <option value="New">New</option>
              </select>
            </div>

            <div class="md:col-span-2">
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-image text-industrial-blue mr-2"></i>
                Image URL *
              </label>
              <input type="url" id="m-image" required
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                placeholder="https://images.unsplash.com/photo-..." oninput="previewImage(this.value)">
              <p class="text-xs text-gray-500 mt-1">Enter a direct link to a high-quality image</p>
            </div>

            <div class="md:col-span-2">
              <label class="block mb-2 font-medium text-industrial-gray">
                <i class="fas fa-exclamation-triangle text-industrial-safety mr-2"></i>
                Safety Notes
              </label>
              <textarea id="m-safetyNotes" rows="3"
                class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                placeholder="Important safety precautions and operational guidelines..."></textarea>
              <p class="text-xs text-gray-500 mt-1">Optional safety information for operators</p>
            </div>
          </div>

          <!-- Common Details Section -->
          <div class="pt-6 border-t border-gray-200">
            <h4 class="font-heading font-bold text-lg mb-4">Common Details</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block mb-2 font-medium text-industrial-gray">
                  <i class="fas fa-map-marker-alt text-industrial-blue mr-2"></i>
                  Location
                </label>
                <input type="text" id="m-location"
                  class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                  placeholder="e.g., Project Site Alpha">
              </div>

              <div>
                <label class="block mb-2 font-medium text-industrial-gray">
                  <i class="fas fa-calendar-alt text-industrial-blue mr-2"></i>
                  Year
                </label>
                <input type="number" id="m-year"
                  class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                  placeholder="e.g., 2021">
              </div>

              <div>
                <label class="block mb-2 font-medium text-industrial-gray">
                  <i class="fas fa-trademark text-industrial-blue mr-2"></i>
                  Brand
                </label>
                <input type="text" id="m-brand"
                  class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                  placeholder="e.g., Caterpillar">
              </div>

              <div>
                <label class="block mb-2 font-medium text-industrial-gray">
                  <i class="fas fa-cube text-industrial-blue mr-2"></i>
                  Model
                </label>
                <input type="text" id="m-model"
                  class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-industrial-yellow focus:ring-2 focus:ring-industrial-yellow/30 focus:outline-none transition-all duration-200"
                  placeholder="e.g., 320D">
              </div>
            </div>
          </div>

          <!-- Image Preview -->
          <div id="imagePreviewContainer" class="hidden mt-6">
            <p class="font-medium mb-2">Image Preview:</p>
            <div class="border-2 border-gray-200 rounded-xl p-4 bg-gray-50">
              <img id="imagePreview" src="" alt="Preview" class="max-h-40 mx-auto rounded-lg">
            </div>
          </div>

          <!-- Form Actions -->
          <div
            class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-gray-200">
            <button type="button" onclick="closeMachineForm()"
              class="px-6 py-3 border-2 border-gray-200 rounded-xl hover:bg-gray-50 transition-colors">
              Cancel
            </button>
            <button type="submit" id="saveMachineButton"
              class="px-6 py-3 bg-industrial-yellow text-industrial-gray font-bold rounded-xl hover:bg-industrial-orange transition-colors shadow-md hover:shadow-lg flex items-center justify-center">
              <i class="fas fa-save mr-2"></i>
              Save Machine
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal"
      class="hidden fixed inset-0 bg-black/70 flex justify-center items-center p-4 z-50 modal-overlay"
      onclick="closeModalOnOutsideClick(event, 'orderDetailsModal')">
      <div
        class="bg-white max-w-3xl w-full p-6 md:p-8 rounded-2xl relative max-h-[90vh] overflow-y-auto shadow-heavy animate-slide-up modal-content"
        onclick="event.stopPropagation()">
        <button onclick="closeOrderDetails()"
          class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl transition-colors">
          <i class="fas fa-times"></i>
        </button>
        <h3 class="text-2xl font-heading font-bold mb-2">Order Details</h3>
        <p class="text-gray-600 mb-6">Order ID: <span id="orderDetailId" class="font-bold"></span></p>
        <div id="orderDetailContent" class="space-y-6"></div>
      </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast"
      class="hidden fixed bottom-4 sm:bottom-6 right-4 sm:right-6 bg-industrial-gray text-white p-4 rounded-xl shadow-heavy z-50 max-w-sm animate-slide-up">
      <div class="flex items-start">
        <i id="toastIcon" class="fas fa-check-circle text-industrial-green mt-0.5 mr-3 text-xl"></i>
        <div class="flex-1">
          <p id="toastTitle" class="font-bold"></p>
          <p id="toastMessage" class="text-sm text-gray-300 mt-1"></p>
        </div>
        <button onclick="hideToast()" class="ml-4 text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ========== GLOBAL CONSTANTS & INITIALIZATION ==========
    const VALID_USERNAME = 'admin';
    const VALID_PASSWORD = 'pass123';
    const STORAGE_KEY_LOGGED_IN = 'adminLoggedIn';

    // Helper functions
    const getMachines = () => JSON.parse(localStorage.getItem("machines")) || [];
    const getOrders = () => JSON.parse(localStorage.getItem("orders")) || [];
    const setMachines = (machines) => localStorage.setItem("machines", JSON.stringify(machines));
    const setOrders = (orders) => localStorage.setItem("orders", JSON.stringify(orders));

    // Status color mapping matching index page
    function getStatusColor(status) {
      switch (status) {
        case 'Available':
        case 'Verified':
        case 'completed':
        case 'confirmed':
        case 'paid':
          return 'industrial-green';
        case 'Rented':
        case 'pending':
        case 'Unverified':
          return 'industrial-yellow';
        case 'Maintenance':
        case 'cancelled':
        case 'refunded':
          return 'industrial-safety';
        case 'pending_payment':
        case 'pending_verification':
          return 'industrial-blue';
        default:
          return 'industrial-gray';
      }
    }

    // Initialize sample orders if not exists
    function initializeOrders() {
      if (!localStorage.getItem("orders")) {
        const machines = getMachines();
        const excavator = machines.find(m => m.id === 101) || { id: 101, name: "CAT 320D Excavator", price: 350 };
        const dozer = machines.find(m => m.id === 102) || { id: 102, name: "Komatsu D155A Dozer", price: 185000 };

        localStorage.setItem("orders", JSON.stringify([
          {
            id: "ORD-" + Date.now() + "-1001",
            date: new Date().toISOString(),
            status: "pending",
            paymentMethod: "cash",
            paymentStatus: "pending",
            deliveryMethod: "delivery",
            total: 1750,
            items: [
              {
                machineId: excavator.id,
                machine: { name: excavator.name, price: excavator.price },
                quantity: 1,
                duration: 5,
                startDate: "2025-12-20",
                endDate: "2025-12-25",
                isRental: true
              }
            ],
            customer: {
              name: "Construction Co Inc.",
              email: "contact@constructionco.com",
              phone: "(555) 123-4567",
              company: "Construction Co Inc.",
              address: "123 Main Street, City, State 12345"
            },
            delivery: {
              date: "2025-12-20",
              time: "morning",
              instructions: "Please call upon arrival"
            },
            notes: ''
          },
          {
            id: "ORD-" + Date.now() + "-1002",
            date: new Date(Date.now() - 86400000).toISOString(), // Yesterday
            status: "pending_payment",
            paymentMethod: "bank",
            paymentStatus: "pending_verification",
            deliveryMethod: "pickup",
            total: 3900,
            items: [
              {
                machineId: dozer.id,
                machine: { name: dozer.name, price: dozer.price },
                isRental: false,
                quantity: 1
              }
            ],
            customer: {
              name: "BuildRight Contractors",
              email: "info@buildright.com",
              phone: "(555) 987-6543",
              company: "BuildRight Contractors",
              address: ""
            },
            notes: 'Awaiting bank transfer confirmation'
          },
          {
            id: "ORD-" + Date.now() + "-1003",
            date: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
            status: "completed",
            paymentMethod: "cash",
            paymentStatus: "paid",
            deliveryMethod: "delivery",
            total: 2520,
            items: [
              {
                machineId: 104,
                machine: { name: "Wheel Loader 966H", price: 300 },
                quantity: 3,
                duration: 7,
                startDate: "2025-12-18",
                endDate: "2025-12-25",
                isRental: true
              }
            ],
            customer: {
              name: "Warehouse Solutions",
              email: "rentals@warehousesolutions.com",
              phone: "(555) 456-7890",
              company: "Warehouse Solutions",
              address: "456 Industrial Park, City, State 12345"
            },
            delivery: {
              date: "2025-12-18",
              time: "afternoon",
              instructions: "Use side gate"
            },
            notes: 'Completed successfully'
          }
        ]));
      }
    }

    // Initialize machines if not exists
    function initializeMachines() {
      if (!localStorage.getItem("machines")) {
        const today = new Date().toISOString().split('T')[0];
        const initialMachines = [
          {
            id: 101,
            type: "EXCAVATOR",
            listingType: 'Rent',
            name: "CAT 320D Excavator",
            price: 350,
            image: "https://images.unsplash.com/photo-1579761596207-6c2306f1d07c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=1080",
            status: "Available",
            condition: "Excellent",
            rating: 4.8,
            lastService: "2025-07-10",
            safetyNotes: "Operator certification required. Helmet and safety boots mandatory.",
            availableFrom: today,
            bookings: [],
            common: {
              location: "Project Site Alpha",
              inspectionLoc: "Main Yard, Zone B",
              year: 2021,
              brand: "Caterpillar",
              model: "320D",
              paymentTerms: "Monthly",
              workingHours: "10 hrs",
              idleTime: "4 hrs",
              fuel: "Without Fuel",
              transport: "To & From (Client Scope)"
            },
            specs: {}
          },
          {
            id: 102,
            type: "DOZER",
            listingType: 'Sale',
            name: "Komatsu D155A Dozer",
            price: 185000,
            image: "https://images.unsplash.com/photo-1589939705384-5185137a7f0f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=1080",
            status: "Available",
            condition: "Excellent",
            rating: 4.7,
            lastService: "2025-06-28",
            safetyNotes: "Requires experienced operator. Check blade condition before use.",
            availableFrom: today,
            bookings: [],
            common: {
              location: "Warehouse Central",
              inspectionLoc: "Warehouse Central",
              year: 2020,
              brand: "Komatsu",
              model: "D155A",
              paymentTerms: "Advance 50%",
              workingHours: "N/A",
              idleTime: "N/A",
              fuel: "N/A",
              transport: "Client Arrangement"
            },
            specs: {}
          }
        ];
        localStorage.setItem("machines", JSON.stringify(initialMachines));
      }
    }

    // ========== MOBILE MENU ==========
    function toggleMobileMenu() {
      const sidebar = document.getElementById('mobileSidebar');
      sidebar.classList.toggle('hidden');
    }

    // ========== MODAL UTILITIES ==========
    function closeModalOnOutsideClick(event, modalId) {
      if (event.target.classList.contains('modal-overlay')) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('hidden');
        }
      }
    }

    // ========== AUTHENTICATION ==========
    function login(event) {
      event.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorEl = document.getElementById('loginError');
      const button = event.target.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;

      // Show loading state
      button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Authenticating...';
      button.disabled = true;

      // Simulate network delay
      setTimeout(() => {
        if (username === VALID_USERNAME && password === VALID_PASSWORD) {
          localStorage.setItem(STORAGE_KEY_LOGGED_IN, 'true');
          errorEl.classList.add('hidden');
          showAdminContent();
          showNotification('Login Successful', 'Welcome to the Admin Dashboard', 'success');
        } else {
          errorEl.classList.remove('hidden');
          button.innerHTML = originalText;
          button.disabled = false;
        }
      }, 800);
    }

    function logout() {
      localStorage.removeItem(STORAGE_KEY_LOGGED_IN);
      hideAdminContent();
      showNotification('Logged Out', 'You have been successfully logged out', 'info');
    }

    function checkAuthentication() {
      const isLoggedIn = localStorage.getItem(STORAGE_KEY_LOGGED_IN) === 'true';
      if (isLoggedIn) {
        showAdminContent();
      } else {
        hideAdminContent();
      }
    }

    function showAdminContent() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('adminContent').classList.remove('hidden');
      showTab('dashboard');
    }

    function hideAdminContent() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('adminContent').classList.add('hidden');
    }

    // ========== NOTIFICATION SYSTEM ==========
    function showNotification(title, message, type = 'success') {
      const toast = document.getElementById('notificationToast');
      const icon = document.getElementById('toastIcon');
      const toastTitle = document.getElementById('toastTitle');
      const toastMessage = document.getElementById('toastMessage');

      // Set icon based on type
      const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
      };

      const colors = {
        success: 'industrial-green',
        error: 'industrial-safety',
        warning: 'industrial-yellow',
        info: 'industrial-blue'
      };

      icon.className = `fas ${icons[type]} text-${colors[type]} mt-0.5 mr-3 text-xl`;
      toastTitle.textContent = title;
      toastMessage.textContent = message;

      toast.classList.remove('hidden');

      // Auto-hide after 5 seconds
      setTimeout(() => {
        if (!toast.classList.contains('hidden')) {
          hideToast();
        }
      }, 5000);
    }

    function hideToast() {
      document.getElementById('notificationToast').classList.add('hidden');
    }

    // ========== TAB MANAGEMENT ==========
    let currentTab = 'dashboard';

    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));

      // Deactivate all tab buttons (sidebar)
      document.querySelectorAll('[id^="tab-"]').forEach(btn => {
        btn.classList.remove('bg-industrial-yellow', 'text-industrial-gray', 'shadow-md');
        btn.classList.add('text-gray-400', 'hover:bg-gray-800', 'hover:text-white');
      });

      // Show the selected tab content
      document.getElementById(tabName).classList.remove('hidden');

      // Activate the selected tab button (sidebar)
      const activeBtn = document.getElementById(`tab-${tabName}`);
      if (activeBtn) {
        activeBtn.classList.remove('text-gray-400', 'hover:bg-gray-800', 'hover:text-white');
        activeBtn.classList.add('bg-industrial-yellow', 'text-industrial-gray', 'shadow-md');
      }

      // Update mobile tab select if exists
      const mobileSelect = document.getElementById('mobileTabSelect');
      if (mobileSelect) mobileSelect.value = tabName;

      currentTab = tabName;

      // Refresh content for the active tab
      if (tabName === 'inventory') {
        renderInventory();
      } else if (tabName === 'orders') {
        renderOrders();
      } else if (tabName === 'dashboard') {
        renderDashboard();
      }
    }

    // ========== DASHBOARD FUNCTIONS ==========
    function renderDashboard() {
      const machines = getMachines();
      const orders = getOrders();

      // Calculate stats
      const totalMachines = machines.length;
      const availableMachines = machines.filter(m => m.status === 'Available').length;
      const rentedMachines = machines.filter(m => m.status === 'Rented').length;
      const pendingOrders = orders.filter(o => o.status === 'pending' || o.status === 'pending_payment').length;
      const unverifiedPayments = orders.filter(o => o.paymentStatus === 'pending_verification').length;

      // Update dashboard elements
      document.getElementById('dashboard-total-machines').textContent = totalMachines;
      document.getElementById('available-machines').textContent = `${availableMachines} available`;
      document.getElementById('rented-machines').textContent = `${rentedMachines} rented`;
      document.getElementById('dashboard-pending-orders').textContent = pendingOrders;
      document.getElementById('dashboard-unverified-payments').textContent = unverifiedPayments;

      // Update recent activity
      const recentActivity = document.getElementById('recentActivity');
      recentActivity.innerHTML = '';

      // Get recent orders
      const recentOrders = [...orders]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 3);

      if (recentOrders.length === 0) {
        recentActivity.innerHTML = `
            <div class="text-center py-8">
                <i class="fas fa-clock text-gray-300 text-3xl mb-3"></i>
                <p class="text-gray-500">No recent activity</p>
            </div>
        `;
      } else {
        recentOrders.forEach(order => {
          const date = new Date(order.date);
          const timeAgo = getTimeAgo(date);
          let icon = 'fa-shopping-cart';
          let color = 'blue';

          if (order.status === 'completed') {
            icon = 'fa-check-circle';
            color = 'green';
          } else if (order.status === 'pending_payment') {
            icon = 'fa-clock';
            color = 'yellow';
          }

          recentActivity.innerHTML += `
                <div class="flex items-center p-3 bg-gray-50 rounded-xl">
                    <div class="w-10 h-10 bg-${color}-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas ${icon} text-${color}-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium">${order.status === 'completed' ? 'Order completed' : 'New order placed'}</p>
                        <p class="text-sm text-gray-500">${order.id}</p>
                    </div>
                    <span class="text-sm text-gray-500">${timeAgo}</span>
                </div>
            `;
        });
      }
    }

    function getTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 60) {
        return `${diffMins} min ago`;
      } else if (diffHours < 24) {
        return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      } else {
        return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
      }
    }

    function refreshAllData() {
      showNotification('Refreshing Data', 'Updating dashboard with latest information...', 'info');
      renderDashboard();
      if (currentTab === 'inventory') renderInventory();
      if (currentTab === 'orders') renderOrders();

      // Show success message after a short delay
      setTimeout(() => {
        showNotification('Data Refreshed', 'All data has been updated successfully', 'success');
      }, 800);
    }

    // ========== INVENTORY MANAGEMENT (GRID VIEW) ==========
    function renderInventory() {
      const machines = getMachines();
      const grid = document.getElementById('inventoryGrid');
      const loading = document.getElementById('inventoryLoading');
      const empty = document.getElementById('inventoryEmpty');

      // Show loading
      if (loading) loading.classList.remove('hidden');
      if (empty) empty.classList.add('hidden');
      if (grid) grid.innerHTML = '';

      // Simulate loading delay for better UX
      setTimeout(() => {
        // Check if empty
        if (!machines || machines.length === 0) {
          if (loading) loading.classList.add('hidden');
          if (empty) empty.classList.remove('hidden');
          return;
        }

        // Render grid
        if (grid) {
          grid.innerHTML = machines.map(m => {
            const statusColor = getStatusColor(m.status);
            const isRent = m.listingType === 'Rent';
            const priceDisplay = isRent ?
              `$${m.price}<span class="text-sm font-normal text-gray-500">/day</span>` :
              `$${m.price ? m.price.toLocaleString() : '0'}`;

            return `
                    <div class="bg-white rounded-2xl shadow-card overflow-hidden border border-gray-200 hover:shadow-card-hover transition-all duration-300">
                        <div class="relative h-48 overflow-hidden">
                            <img src="${m.image || 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=400&h=300&fit=crop'}" 
                                alt="${m.name}" 
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                onerror="this.src='https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=400&h=300&fit=crop'">
                            <div class="absolute top-3 right-3">
                                <span class="status-badge bg-${statusColor} text-white">
                                    ${m.status || 'Available'}
                                </span>
                            </div>
                            <div class="absolute top-3 left-3">
                                <span class="px-2 py-1 rounded-full text-xs font-bold text-white bg-black/50 backdrop-blur-md border border-white/20 uppercase">
                                    ${m.type || 'Machine'}
                                </span>
                            </div>
                        </div>
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-heading font-bold text-lg truncate">${m.name || 'Unnamed Machine'}</h3>
                                <span class="font-bold text-industrial-yellow text-lg">${priceDisplay}</span>
                            </div>
                            
                            <div class="mb-4 flex flex-wrap gap-2">
                                <span class="px-3 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">
                                    ${m.common?.brand || 'Unknown'}
                                </span>
                                <span class="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                    ${m.listingType || 'Rent'}
                                </span>
                            </div>
                            
                            <div class="flex items-center mb-4">
                                <span class="text-yellow-500 text-sm">⭐</span>
                                <span class="font-semibold text-sm ml-1">${m.rating || '4.5'}</span>
                                <span class="mx-2">•</span>
                                <span class="text-sm text-gray-600">${m.common?.year || 'N/A'}</span>
                            </div>
                            
                            ${m.safetyNotes ? `
                            <div class="mb-4 text-sm text-gray-600 bg-yellow-50 p-3 rounded-xl border-l-4 border-yellow-500">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i>
                                <span class="font-medium">Safety:</span> ${m.safetyNotes.substring(0, 60)}${m.safetyNotes.length > 60 ? '...' : ''}
                            </div>
                            ` : ''}
                            
                            <div class="flex justify-between pt-4 border-t border-gray-200">
                                <span class="text-xs text-gray-500">
                                    ID: ${m.id}
                                </span>
                                <div class="flex space-x-2">
                                    <button onclick="editMachine(${m.id})" 
                                        class="px-3 py-1 text-sm bg-industrial-blue text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                                        <i class="fas fa-edit mr-1"></i> Edit
                                    </button>
                                    <button onclick="deleteMachine(${m.id})" 
                                        class="px-3 py-1 text-sm bg-industrial-safety text-white rounded-lg hover:bg-red-700 transition-colors flex items-center">
                                        <i class="fas fa-trash mr-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
          }).join('');
        }

        if (loading) loading.classList.add('hidden');

        // Apply any active filters
        filterInventoryGrid();
      }, 300);
    }

    function filterInventoryGrid() {
      const searchTerm = document.getElementById('inventorySearch')?.value.toLowerCase() || '';
      const categoryFilter = document.getElementById('inventoryFilter')?.value || 'all';
      const cards = document.querySelectorAll('#inventoryGrid > div.bg-white');

      let visibleCount = 0;

      cards.forEach(card => {
        if (!card) return;

        const nameElement = card.querySelector('h3');
        const categoryElement = card.querySelector('.bg-gray-100');

        if (!nameElement || !categoryElement) {
          card.style.display = 'none';
          return;
        }

        const name = nameElement.textContent.toLowerCase();
        const category = categoryElement.textContent;
        const matchesSearch = name.includes(searchTerm);
        const matchesCategory = categoryFilter === 'all' || category.includes(categoryFilter);

        if (matchesSearch && matchesCategory) {
          card.style.display = '';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      // Show/hide empty state
      const empty = document.getElementById('inventoryEmpty');
      if (empty) {
        if (visibleCount === 0 && cards.length > 0) {
          empty.classList.remove('hidden');
          empty.innerHTML = `
                <i class="fas fa-search text-gray-300 text-4xl mb-4"></i>
                <h3 class="text-xl font-heading font-bold text-gray-500">No matching machines</h3>
                <p class="text-gray-400 mt-2">Try adjusting your search or filter</p>
            `;
        } else {
          empty.classList.add('hidden');
        }
      }
    }

    // ========== MACHINE FORM (CRUD) ==========
    function previewImage(url) {
      const previewContainer = document.getElementById('imagePreviewContainer');
      const previewImg = document.getElementById('imagePreview');

      if (url && url.startsWith('http')) {
        previewImg.src = url;
        previewContainer.classList.remove('hidden');
      } else {
        previewContainer.classList.add('hidden');
      }
    }

    function openMachineForm(id) {
      const modal = document.getElementById('machineFormModal');
      const form = document.getElementById('machineForm');

      // Reset form
      form.reset();
      document.getElementById('formErrors').classList.add('hidden');
      document.getElementById('imagePreviewContainer').classList.add('hidden');
      document.getElementById('machineId').value = '';
      document.getElementById('machineFormTitle').textContent = 'Add New Machine';

      // If editing, populate form
      if (id) {
        const machine = getMachines().find(m => m.id === id);
        if (machine) {
          document.getElementById('machineFormTitle').textContent = 'Edit Machine: ' + machine.name;
          document.getElementById('machineId').value = machine.id;
          document.getElementById('m-name').value = machine.name;
          document.getElementById('m-category').value = machine.type;
          document.getElementById('m-price').value = machine.price;
          document.getElementById('m-listingType').value = machine.listingType;
          document.getElementById('m-status').value = machine.status;
          document.getElementById('m-condition').value = machine.condition;
          document.getElementById('m-image').value = machine.image;
          document.getElementById('m-safetyNotes').value = machine.safetyNotes || '';
          document.getElementById('m-location').value = machine.common?.location || '';
          document.getElementById('m-year').value = machine.common?.year || '';
          document.getElementById('m-brand').value = machine.common?.brand || '';
          document.getElementById('m-model').value = machine.common?.model || '';

          // Trigger image preview
          if (machine.image) {
            previewImage(machine.image);
          }
        }
      }

      modal.classList.remove('hidden');
    }

    function closeMachineForm() {
      document.getElementById('machineFormModal').classList.add('hidden');
    }

    function validateMachineForm() {
      const errors = [];
      const name = document.getElementById('m-name').value.trim();
      const price = parseFloat(document.getElementById('m-price').value);
      const image = document.getElementById('m-image').value.trim();

      // Name validation
      if (name.length < 2) {
        errors.push('Machine name must be at least 2 characters long');
      }

      // Price validation
      if (isNaN(price) || price < 1) {
        errors.push('Price must be at least $1');
      }

      // Image URL validation (basic)
      if (image && !image.startsWith('http')) {
        errors.push('Image URL must be a valid web address (starting with http:// or https://)');
      }

      return errors;
    }

    function saveMachine(event) {
      event.preventDefault();

      // Validate form
      const errors = validateMachineForm();
      if (errors.length > 0) {
        const errorList = document.getElementById('errorList');
        errorList.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
        document.getElementById('formErrors').classList.remove('hidden');
        return;
      }

      // Hide errors
      document.getElementById('formErrors').classList.add('hidden');

      // Show loading state
      const button = document.getElementById('saveMachineButton');
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Saving...';
      button.disabled = true;

      // Simulate API delay
      setTimeout(() => {
        let machines = getMachines();
        const id = document.getElementById('machineId').value;

        const newMachine = {
          name: document.getElementById('m-name').value.trim(),
          type: document.getElementById('m-category').value,
          price: parseFloat(document.getElementById('m-price').value),
          listingType: document.getElementById('m-listingType').value,
          status: document.getElementById('m-status').value,
          condition: document.getElementById('m-condition').value,
          image: document.getElementById('m-image').value.trim(),
          safetyNotes: document.getElementById('m-safetyNotes').value.trim(),
          rating: 4.5,
          lastService: new Date().toISOString().split('T')[0],
          availableFrom: new Date().toISOString().split('T')[0],
          bookings: [],
          specs: {},
          common: {
            location: document.getElementById('m-location').value.trim(),
            inspectionLoc: document.getElementById('m-location').value.trim(),
            year: document.getElementById('m-year').value,
            brand: document.getElementById('m-brand').value.trim(),
            model: document.getElementById('m-model').value.trim(),
            paymentTerms: "Monthly",
            workingHours: "10 hrs",
            idleTime: "4 hrs",
            fuel: "Without Fuel",
            transport: "To & From (Client Scope)"
          }
        };

        if (id) {
          // EDIT existing machine
          const index = machines.findIndex(m => m.id === parseInt(id));
          if (index > -1) {
            machines[index] = { ...machines[index], ...newMachine, id: parseInt(id) };
            showNotification('Machine Updated', `${newMachine.name} has been updated successfully`, 'success');
          }
        } else {
          // ADD new machine
          const nextId = machines.length > 0 ? Math.max(...machines.map(m => m.id || 0)) + 1 : 101;
          newMachine.id = nextId;
          machines.push(newMachine);
          showNotification('Machine Added', `${newMachine.name} has been added to inventory`, 'success');
        }

        setMachines(machines);
        closeMachineForm();

        // Reset button
        button.innerHTML = originalText;
        button.disabled = false;

        // Refresh inventory if on that tab
        if (currentTab === 'inventory') {
          renderInventory();
        }

        // Update dashboard
        renderDashboard();
      }, 800);
    }

    function editMachine(id) {
      openMachineForm(id);
    }

    function deleteMachine(id) {
      const machine = getMachines().find(m => m.id === id);
      if (!machine) return;

      if (confirm(`Are you sure you want to delete "${machine.name}"? This action cannot be undone.`)) {
        let machines = getMachines();
        machines = machines.filter(m => m.id !== id);
        setMachines(machines);

        renderInventory();
        showNotification('Machine Deleted', `${machine.name} has been removed from inventory`, 'warning');
      }
    }

    // ========== ORDER MANAGEMENT ==========
    function renderOrders() {
      const orders = getOrders();
      const list = document.getElementById('orderList');
      const loading = document.getElementById('ordersLoading');
      const empty = document.getElementById('ordersEmpty');

      // Show loading
      if (list) list.innerHTML = '';
      if (loading) loading.classList.remove('hidden');
      if (empty) empty.classList.add('hidden');

      // Simulate loading delay
      setTimeout(() => {
        // Sort by newest first
        let sortedOrders = [...orders].sort((a, b) => new Date(b.date) - new Date(a.date));

        // Check if empty
        if (!sortedOrders || sortedOrders.length === 0) {
          if (loading) loading.classList.add('hidden');
          if (empty) empty.classList.remove('hidden');
          return;
        }

        // Render table
        if (list) {
          list.innerHTML = sortedOrders.map(o => {
            const statusColor = getStatusColor(o.status);
            const paymentColor = getStatusColor(o.paymentStatus);
            const date = new Date(o.date);
            const formattedDate = date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });

            let statusText = o.status;
            if (o.status === 'pending_payment') statusText = 'Awaiting Payment';
            if (o.status === 'confirmed') statusText = 'Confirmed';
            if (o.status === 'completed') statusText = 'Completed';
            if (o.status === 'cancelled') statusText = 'Cancelled';

            // Determine button text based on status
            let buttonText = 'Mark as Paid';
            let buttonColor = 'industrial-yellow';
            let buttonAction = `markOrderAsPaid('${o.id}')`;

            if (o.status === 'completed' || o.paymentStatus === 'paid') {
              buttonText = 'Completed';
              buttonColor = 'industrial-green';
              buttonAction = `openOrderDetails('${o.id}')`;
            } else if (o.status === 'cancelled') {
              buttonText = 'Cancelled';
              buttonColor = 'industrial-safety';
              buttonAction = `openOrderDetails('${o.id}')`;
            }

            return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="p-4 font-bold">
                            <div class="flex items-center">
                                <i class="fas fa-receipt text-industrial-blue mr-2"></i>
                                <span class="text-sm">${o.id}</span>
                            </div>
                        </td>
                        <td class="p-4">${formattedDate}</td>
                        <td class="p-4 font-bold">$${o.total ? o.total.toLocaleString() : '0'}</td>
                        <td class="p-4">
                            <span class="status-badge bg-${paymentColor} text-white">
                                ${o.paymentMethod === 'cash' ? 'Cash' : 'Bank'}
                            </span>
                        </td>
                        <td class="p-4">
                            <button onclick="${buttonAction}" 
                                class="status-badge bg-${buttonColor} text-white hover:opacity-80 transition-opacity">
                                ${buttonText}
                            </button>
                        </td>
                        <td class="p-4">
                            <div>
                                <p class="font-medium truncate max-w-[150px]">${o.customer?.name || 'Unknown'}</p>
                                <p class="text-xs text-gray-500 truncate max-w-[150px]">${o.customer?.email || ''}</p>
                            </div>
                        </td>
                        <td class="p-4 text-center">
                            <div class="flex justify-center space-x-2">
                                <button onclick="openOrderDetails('${o.id}')" 
                                    class="px-3 py-1 text-sm bg-industrial-blue text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                                    <i class="fas fa-eye mr-1"></i> View
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
          }).join('');
        }

        if (loading) loading.classList.add('hidden');

        // Apply any active filters
        filterOrderTable();
      }, 300);
    }

    function filterOrderTable() {
      const searchTerm = document.getElementById('orderSearch')?.value.toLowerCase() || '';
      const statusFilter = document.getElementById('orderStatusFilter')?.value || 'all';
      const rows = document.querySelectorAll('#orderList tr');

      let visibleCount = 0;

      rows.forEach(row => {
        const orderId = row.querySelector('td:nth-child(1)')?.textContent.toLowerCase() || '';
        const customer = row.querySelector('td:nth-child(6)')?.textContent.toLowerCase() || '';
        const status = row.querySelector('td:nth-child(5) button')?.textContent.toLowerCase() || '';
        const matchesSearch = orderId.includes(searchTerm) || customer.includes(searchTerm);
        const matchesStatus = statusFilter === 'all' ||
          (statusFilter === 'pending' && status.includes('pending')) ||
          (statusFilter === 'pending_payment' && (status.includes('awaiting') || status.includes('paid'))) ||
          (statusFilter === 'confirmed' && status.includes('confirmed')) ||
          (statusFilter === 'completed' && status.includes('completed')) ||
          (statusFilter === 'cancelled' && status.includes('cancelled'));

        if (matchesSearch && matchesStatus) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      });

      // Show/hide empty state
      const empty = document.getElementById('ordersEmpty');
      if (empty) {
        if (visibleCount === 0 && rows.length > 0) {
          empty.classList.remove('hidden');
          empty.innerHTML = `
                <i class="fas fa-search text-gray-300 text-4xl mb-4"></i>
                <h3 class="text-xl font-heading font-bold text-gray-500">No matching orders</h3>
                <p class="text-gray-400 mt-2">Try adjusting your search or filter</p>
            `;
        } else {
          empty.classList.add('hidden');
        }
      }
    }

    function markOrderAsPaid(orderId) {
      if (!confirm('Mark this order as paid and complete?')) return;

      let orders = getOrders();
      const index = orders.findIndex(o => o.id === orderId);

      if (index > -1) {
        orders[index].status = 'completed';
        orders[index].paymentStatus = 'paid';

        setOrders(orders);
        renderOrders();
        renderDashboard();

        showNotification(
          'Order Marked as Paid',
          `Order ${orderId} has been marked as paid and completed`,
          'success'
        );
      }
    }

    function openOrderDetails(orderId) {
      const orders = getOrders();
      const machines = getMachines();
      const order = orders.find(o => o.id === orderId);

      if (!order) return;

      document.getElementById('orderDetailId').textContent = orderId;

      const date = new Date(order.date);
      const formattedDate = date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      let itemsHtml = '';
      if (order.items && order.items.length > 0) {
        order.items.forEach(item => {
          const machine = machines.find(m => m.id === item.machineId);
          itemsHtml += `
                <div class="border border-gray-200 rounded-xl p-4 mb-3">
                    <div class="flex justify-between items-start">
                        <div>
                            <h5 class="font-bold">${machine?.name || 'Unknown Machine'}</h5>
                            <p class="text-sm text-gray-600">${item.isRental ? `Rental: ${item.quantity} × ${item.duration} days` : 'Purchase'}</p>
                            ${item.startDate ? `<p class="text-sm text-gray-500 mt-1">${item.startDate} to ${item.endDate}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="font-bold">$${item.isRental ? (machine?.price * item.quantity * item.duration) : machine?.price || 0}</p>
                            <p class="text-sm text-gray-500">${item.isRental ? 'Rental total' : 'Purchase price'}</p>
                        </div>
                    </div>
                </div>
            `;
        });
      } else {
        itemsHtml = '<p class="text-gray-500">No items in this order</p>';
      }

      let actionButton = '';
      if (order.status !== 'completed' && order.status !== 'cancelled') {
        actionButton = `
            <button onclick="markOrderAsPaid('${order.id}')" class="px-6 py-3 bg-industrial-yellow text-industrial-gray font-bold rounded-xl hover:bg-industrial-orange transition-colors">
                Mark as Paid
            </button>
        `;
      }

      let content = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-50 p-6 rounded-2xl">
                <h4 class="font-heading font-bold text-lg mb-3">Order Information</h4>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Order ID:</span>
                        <span class="font-bold">${order.id}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Date Placed:</span>
                        <span>${formattedDate}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Status:</span>
                        <span class="font-medium text-${getStatusColor(order.status)}">${order.status}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Payment Method:</span>
                        <span>${order.paymentMethod === 'cash' ? 'Cash on Delivery' : 'Bank Transfer'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Payment Status:</span>
                        <span class="font-medium text-${getStatusColor(order.paymentStatus)}">${order.paymentStatus}</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 rounded-2xl">
                <h4 class="font-heading font-bold text-lg mb-3">Customer Information</h4>
                <div class="space-y-2">
                    <div>
                        <p class="text-gray-600">Name</p>
                        <p class="font-medium">${order.customer?.name || 'Unknown'}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Email</p>
                        <p class="font-medium">${order.customer?.email || 'No email'}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Phone</p>
                        <p class="font-medium">${order.customer?.phone || 'No phone'}</p>
                    </div>
                    ${order.customer?.company ? `
                    <div>
                        <p class="text-gray-600">Company</p>
                        <p class="font-medium">${order.customer.company}</p>
                    </div>
                    ` : ''}
                </div>
            </div>
        </div>
        
        <div class="mt-6">
            <h4 class="font-heading font-bold text-lg mb-3">Order Items</h4>
            <div class="space-y-2">
                ${itemsHtml}
            </div>
        </div>
        
        <div class="mt-6 bg-yellow-50 p-6 rounded-2xl border-l-4 border-yellow-500">
            <h4 class="font-heading font-bold text-lg mb-3">Delivery & Notes</h4>
            <p><span class="font-medium">Delivery Method:</span> ${order.deliveryMethod === 'pickup' ? 'Pickup at Warehouse' : 'Delivery to Site'}</p>
            ${order.delivery ? `
                <p class="mt-2"><span class="font-medium">Delivery Date:</span> ${order.delivery.date}</p>
                <p><span class="font-medium">Time Window:</span> ${order.delivery.time}</p>
                ${order.delivery.instructions ? `<p><span class="font-medium">Instructions:</span> ${order.delivery.instructions}</p>` : ''}
            ` : ''}
            ${order.notes ? `<p class="mt-2"><span class="font-medium">Notes:</span> ${order.notes}</p>` : ''}
        </div>
        
        <div class="mt-6 pt-6 border-t border-gray-200 flex justify-between items-center">
            <div>
                <p class="text-gray-600">Total Amount</p>
                <p class="font-heading font-bold text-3xl text-industrial-yellow">$${order.total ? order.total.toLocaleString() : '0'}</p>
            </div>
            <div class="space-x-3">
                ${actionButton}
                <button onclick="closeOrderDetails()" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition-colors">
                    Close
                </button>
            </div>
        </div>
    `;

      document.getElementById('orderDetailContent').innerHTML = content;
      document.getElementById('orderDetailsModal').classList.remove('hidden');
    }

    function closeOrderDetails() {
      document.getElementById('orderDetailsModal').classList.add('hidden');
    }

    // ========== AUTHENTICATION ==========
    function login(e) {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const loginError = document.getElementById('loginError');

      // Super Admin hardcoded login - redirect to super admin dashboard
      if (username === 'admin' && password === 'pass123') {
        window.location.href = 'super_admin_dashboard.html';
        return;
      }

      // Partner login (check against localStorage)
      const users = JSON.parse(localStorage.getItem('super_admin_users') || '[]');
      const user = users.find(u => u.email === username && u.password === password && u.role === 'Partner');

      if (!user) {
        // Invalid credentials
        loginError.querySelector('span').textContent = 'Invalid username or password. Please try again.';
        loginError.classList.remove('hidden');
        return;
      }

      // Check if user is pending approval
      if (user.status === 'Pending') {
        loginError.querySelector('span').textContent = 'Your account is pending admin approval. Please wait for activation.';
        loginError.classList.remove('hidden');
        return;
      }

      // Check if user is active
      if (user.status !== 'Active') {
        loginError.querySelector('span').textContent = 'Your account is not active. Please contact the administrator.';
        loginError.classList.remove('hidden');
        return;
      }

      // Successful login - store session and show admin content (STAY ON admin.html)
      localStorage.setItem('current_admin_user', JSON.stringify(user));
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('adminContent').classList.remove('hidden');
      loginError.classList.add('hidden');

      // Update UI with partner name
      updatePartnerInfo();
    }

    function updatePartnerInfo() {
      const userStr = localStorage.getItem('current_admin_user');
      if (!userStr) return;

      const user = JSON.parse(userStr);

      // Update any elements that should show partner name
      const partnerNameElements = document.querySelectorAll('.partner-name');
      partnerNameElements.forEach(el => {
        el.textContent = user.name;
      });

      // Update company name if exists
      const companyElements = document.querySelectorAll('.partner-company');
      companyElements.forEach(el => {
        el.textContent = user.company || '';
      });
    }

    function checkAuthentication() {
      // Check if user is already logged in
      const currentUser = localStorage.getItem('current_admin_user');
      if (currentUser) {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('adminContent').classList.remove('hidden');
        updatePartnerInfo();
      }
    }

    function logout() {
      localStorage.removeItem('current_admin_user');
      window.location.reload();
    }

    // ========== DATA INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function () {
      initializeMachines();
      initializeOrders();
      checkAuthentication();

      // Initialize mobile menu button
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
      }

      // Keyboard shortcuts
      document.addEventListener('keydown', function (e) {
        // Escape key to close modals
        if (e.key === 'Escape') {
          closeMachineForm();
          closeOrderDetails();
          const mobileSidebar = document.getElementById('mobileSidebar');
          if (mobileSidebar && !mobileSidebar.classList.contains('hidden')) {
            toggleMobileMenu();
          }
        }

        // Ctrl+F for search
        if ((e.ctrlKey || e.metaKey) && e.key === 'f' && currentTab === 'inventory') {
          e.preventDefault();
          const searchInput = document.getElementById('inventorySearch');
          if (searchInput) searchInput.focus();
        }
      });
    });
  </script>

</body>

</html>